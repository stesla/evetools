<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>evetools</title>
  <link rel='stylesheet' href='/css/styles.css'>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <style>
    [x-cloak] { display: none; }
  </style>
  <script src='/js/alpine.js'></script>
  <script src='/js/app.js'></script>
</head>
<body class="bg-gray-300 text-gray-900"
      x-data="evetools.globalState()"
      x-init="fetchCurrentUser()"
      x-cloak>

  <nav class="px-4 py-2 flex items-center justify-between h-16 bg-gray-900 text-gray-300">

    <div>
      <p class="text-2xl">evetools</p>
    </div>
    <template x-if="loggedIn">
      <div class="relative" @keydown.window="handleEscape($event)">
        <button class="p-1 flex items-center" @click="avatarMenuOpen = !avatarMenuOpen">
        <span class="mx-2 font-semibold" x-text="user.characterName"></span>
        <figure class="h-12 w-12 rounded-full overflow-hidden border-2 border-gray-700 focus:outline-none focus:border-gray-500">
          <img class="h-full w-full object-cover" :src="user.avatarURL" :alt="user.characterName">
        </figure>
        </button>
        <template x-if="avatarMenuOpen">
          <button @click="avatarMenuOpen = false" tabindex="-1" class="fixed inset-0 h-full w-full bg-transparent cursor-default"></button>
        </template>
        <template x-if="avatarMenuOpen">
          <div class="absolute right-0 mt-2 py-2 w-32 bg-white rounded-lg shadow-xl">
            <a class="block px-4 py-2 text-gray-900 hover:bg-blue-500 hover:text-gray-100" href="/logout">Logout</a>
          </div>
        </template>
      </div>
    </template>
  </nav>

  <template x-if="currentView === 'login'">
    <main class="mt-64 text-center max-w-xs mx-auto">
      <h1 class="text-4xl">Do things in EVE!<h1>
      <h2 class="mt-4 text-2xl">From a website!</h2>
      <div class="mt-10 px-5 py-3 rounded-lg bg-blue-600">
        <a class="text-lg text-gray-300 font-semibold uppercase tracking-wider" href="/login">Sign in with EVE</a>
      </div>
    </main>
  </template>

  <template x-if="currentView === 'search'">
    <main class="mt-10 container mx-auto"
          x-data="evetools.marketTypes()"
          x-init="initMarketTypes()">

      <form id="search" @submit="handleSearch($event)">
        <div class="mx-auto flex w-full sm:w-4/5 max-w-screen-sm items-center rounded-md overflow-hidden">
          <input x-model="filter" class="px-4 py-2 w-full bg-gray-100 focus:outline-none"
                 placeholder="Type your search filter here...">
          <button form="search" class="px-4 py-2 bg-blue-500 text-gray-100">
            Search
          </button>
        </div>
      </form>
      <div class="flex flex-wrap justify-around">
        <template x-for="type in marketTypes" :key="type.id">
          <div class="mt-4 sm:ml-4 p-4 w-full lg:w-64 h-48 flex flex-col justify-between rounded-xl shadow-xl bg-gray-100">
            <div>
              <img class="h-12 w-12 float-right" :src="imgURL(type)">
              <h2 class="text-lg font-semibold clearfix" x-text="type.name"></h2>
            </div>
            <a class="block object-bottom mt-4 py-2 px-4 rounded-md shadow-md bg-blue-500 text-gray-300 text-center"
               :href="href(type.id)">View Details</a> 
          </div>
        </template>
      </div>
    </main>
  </template>

  <template x-if="currentView === 'typeDetails'">
    <main class="mt-10 w-full md:w-4/5 max-w-screen-md container mx-auto"
          x-data="evetools.typeInfo()"
          x-init="fetchTypeDetails()">
      <div>
        <a class="text-gray-500 hover:text-gray-700 transition duration-150 ease-in-out inline-flex items-center"
          href="#" @click="window.history.back(); $event.preventDefault();">
          <svg class="arrow-left w-6 h-6"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          <span class="ml-2">Return to the Search Results</span>
        </a>
      </div>
      <template x-if="type">
        <div class="px-4 py-4 w-full mt-4 mx-auto rounded-xl shadow-xl bg-gray-100">
          <div class="flex justify-between items-start">
            <div class="mr-2">
              <h1 class="text-4xl font-bold" x-text="type.name"></h1>
              <p class="mt-4" x-text="type.description"></p>
            </div>
            <img class="border-2 border-gray-600 float-right" :src="imgURL(type)">
          </div>
          <div class="mt-4">
            <template x-if="!marketInfo">
              <p class="text-center italic text-gray-500">Fetching market info...</p>
            </template>
            <template x-if="marketInfo">
              <div class="mx-auto w-3/5">
                <div class="flex justify-between">
                  <div>
                    <dt class="font-bold">Margin</dt>
                    <dd class="font-semibold text-center" x-text="(marketInfo.margin).toLocaleString('en') + '%'"></dd>
                  </div>
                  <div>
                    <dt class="font-bold">Volume</dt>
                    <dd class="font-semibold text-center" x-text="(marketInfo.volume).toLocaleString('en')"></dd>
                  </div>
                  <div>
                    <dt class="font-bold">Jita Buy</dt>
                    <dd class="font-semibold text-center text-red-500" x-text="(marketInfo.buy).toLocaleString('en')">
                  </div>
                  <div>
                    <dt class="font-bold">Jita Sell</dt>
                    <dd class="font-semibold text-center text-green-500" x-text="(marketInfo.sell).toLocaleString('en')">
                  </div>
                </div>
                <div class="mt-4 flex justify-between">
                  <div>
                    <dd class="font-bold">Lowest</dt>
                    <dd class="font-semibold text-center" x-text="(marketInfo.lowest).toLocaleString('en')"></dd>
                  </div>
                  <div>
                    <dd class="font-bold">Average</dt>
                    <dd class="font-semibold text-center" x-text="(marketInfo.average).toLocaleString('en')"></dd>
                  </div>
                  <div>
                    <dd class="font-bold">Highest</dt>
                    <dd class="font-semibold text-center" x-text="(marketInfo.highest).toLocaleString('en')"></dd>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </template>
    </main>
  </template>
</body>
</html>
